<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.72.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>OVH Serial over LAN (SOL)&nbsp;&ndash;&nbsp;Aaron's Ramblings</title><link rel=stylesheet href=/css/core.min.51a44d5b8886c4d68322a4e7f2c4d3a9ae730b123178c37858c71c49e9bba12bcf142960b0cfe957684d097b1bbfb40d.css integrity=sha384-UaRNW4iGxNaDIqTn8sTTqa5zCxIxeMN4WMccSem7oSvPFClgsM/pV2hNCXsbv7QN><meta name=twitter:card content="summary"><meta name=twitter:title content="OVH Serial over LAN (SOL)"><script>(function(f,a,t,h,o,m){a[h]=a[h]||function(){(a[h].q=a[h].q||[]).push(arguments)};o=f.createElement('script'),m=f.getElementsByTagName('script')[0];o.async=1;o.src=t;o.id='fathom-script';m.parentNode.insertBefore(o,m)})(document,window,'//s.geekgonecrazy.com/tracker.js','fathom');fathom('set','siteId','EVTBC');fathom('trackPageview');</script><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">Aaron's Ramblings</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/>Home</a><a class="nav item" href=/about>About</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">OVH Serial over LAN (SOL)</h1><p class="article date">2020-09-07</p></section><article class="article markdown-body"><p>Its been a while since I&rsquo;ve worked with physical servers and typically when something happened I could pretty quickly get physical access to the box if things went pear shaped.</p><p>But when you buy or lease servers from a provider like OVH. Those servers might be sitting half way around the world. So if something goes wrong you need to some how virtually be in front of the keyboard.</p><p>OVH has a few different ways to access your servers console to interact with the machine directly.</p><ul><li>From a Java applet (KVM)</li></ul><p>This way while works across all of the servers.. requires Java Runtime.. Yuck. Not to mention it isn&rsquo;t necessarily going to work on every machine.</p><ul><li>Via your web browser (KVM)</li></ul><p>This way is by far the best. But seems for some reason, i&rsquo;m not completely sure why.. its not available for all of their servers. So its not really a consistent option</p><ul><li>Serial over LAN (SOL)</li></ul><p>This way is probably the most easy to work with. Can access over ssh from any device that can ssh. Which is pretty much anywhere, so very appealing.</p><p>So I really wanted to be able to get Serial over LAN working.</p><h2 id=the-problem>The Problem</h2><hr><p>Out of the box when you connect all you get is:</p><pre><code>    Could not chdir to home directory /home/ipmi: No such file or directory
    
                            OVH
                IPMI Serial Over Lan gateway
    
                IPMI SOL on [Omitted ;-)].us
    
    ipmiutil ver 2.93
    isol ver 2.93
    Opening lan connection to node 10.245.29.163 ...
    Connecting to node 10.245.29.163
    -- BMC version 2.00, IPMI version 2.0
    Opening lanplus connection to node 10.245.29.163 ...
    [SOL session is running, use '~.' to end, '~?' for help.]
</code></pre><p>Hitting enter here should drop you to a login prompt to login to the console. But nothing happens. Turns out this is because out of the box on OVH the linux kernel isn&rsquo;t outputting or opening a tty on the serial port.</p><h2 id=solution>Solution</h2><p>To make the linux kernel output console output and open a tty on the serial port as needed by Serial Over Lan you need to ssh into your server and modify your grub settings to instruct the kernel to open a tty on that serial port. Also to tell it the baud rate to use. The <a href=https://wiki.archlinux.org/index.php/Working_with_the_serial_console target=_blank>arch wiki</a> is useful here.</p><p>From what I can tell this is typically /dev/ttyS1. But if it doesn&rsquo;t work for you try /dev/ttyS0.</p><p>In the bios you can confirm the baud/bit rate. But in my case it was: 115200 and looking around that seems to be the most common.</p><p>First hop into: /etc/default/grub</p><p>and add:</p><pre><code>    GRUB_CMDLINE_LINUX_DEFAULT=&quot;nomodeset console=tty0 console=ttyS1,115200&quot;
    GRUB_TERMINAL=&quot;console serial&quot;
    GRUB_SERIAL_COMMAND=&quot;serial --unit=1 --speed=115200 --word=8 --parity=no --stop=1&quot;
</code></pre><p>This will both set the default linux command args, but also will let you interract with grub over the serial console as well.</p><p>If you do want to be able to interact you will need to add to /boot/grub/menu.lst</p><pre><code>serial --unit=1 --speed=115200
terminal --timeout=5 serial console
</code></pre><p>To give you a chance to interact over serial console to grub.</p><p>To make sure takes effect:</p><pre><code>    sudo update-grub
</code></pre><p>If you want to verify take a peak in /boot/grub/grub.cfg and see if the kernel options are there.</p><p>If you would like to also be able to interact with bios and everything after POST you can also hop into bios via one of the KVM solutions and set this setting to enabled:</p><p><img src=/images/2020-09-:day/screen-shot-2020-09-07-at-14-28-07.png alt></p><p><img src=/images/2020-09-:day/screen-shot-2020-09-07-at-14-29-20.png alt></p><p>I want to thank the author of this blog post for setting me on the right track: <a href=http://divideoverflow.com/2016/07/Configuring_IPMI_on_OVH_server/>http://divideoverflow.com/2016/07/Configuring_IPMI_on_OVH_server/</a></p></article></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/2020/08/28/decision-fatigue-in-2020/><span class="iconfont icon-article"></span>Decision Fatigue in 2020</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>Aaron's Ramblings</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p></div></section></body></html>